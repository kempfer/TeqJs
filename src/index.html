<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Teq Local Cloud</title>
		<script type="text/javascript"  src="Teq.js"></script>		
		<script type="text/javascript"  src="plugins/TeqArray.js"></script>
		<script type="text/javascript"  src="plugins/TeqDom.js"></script>
		<script type="text/javascript"  src="plugins/TeqNumber.js"></script>
		<script type="text/javascript"  src="plugins/TeqObject.js"></script>
		<script type="text/javascript"  src="plugins/TeqString.js"></script>		
		<script type="text/javascript"  src="plugins/TeqWebSql.js"></script>		
		<script type="text/javascript"  src="plugins/TeqPromise.js"></script>
		<script type="text/javascript"  src="plugins/TeqClass.js"></script>								
		<script type="text/javascript"  src="plugins/TeqBasesClass.js"></script>		
		<script type="text/javascript"  src="plugins/TeqModelWebSql.js"></script>		
	</head>
	<body>
		<script>
			var model;
			var test;
			t.dom.onReady(function () {
				
				var db = t.webSql({name : "local_cloud"});
				/*db.execute("CREATE TABLE file_manage (id INTEGER PRIMARY KEY   AUTOINCREMENT, label TEXT, timestamp REAL)",[]).then(
					function success (result) {
						console.log(result);
					},
					function error (error) {
						console.error("errr");
						console.log(error);
					}
				);*/
				//db.execute("INSERT INTO file_manage (label, timestamp) VALUES (?, ?)",["Test~!#$%^&*()_+}{+*Upoo-#oikl.-aa#äääääpü+", new Date()]);
				/*db.queryAll("SELECT label FROM file_manage ",[]).then(function (result) {
					console.log(result);
				});*/
			
					t.Class.define('FilemanagerModel',{
						Extend : t.data.ModelWebSlq,
						
						fields : [
							'external_id',
							'name',
							'local_path',
							'parent_id',
							'type',
							'last_action_id',
							'hash',
							'updated'
						],						
						getDBConnect : function () {
							return db;
						},
						getTableName : function () {
							return "file_manager";
						},
						getTableSql : function () {
							return  "CREATE TABLE IF NOT EXISTS file_manager (\n\
								id INTEGER PRIMARY KEY   AUTOINCREMENT,\n\
								external_id INTEGER,\n\
								name TEXT,\n\
								local_path TEXT,\n\
								parent_id INTEGER,\n\
								type INTEGER,\n\
								last_action_id INTEGER,\n\
								hash TEXT,\n\
								updated INTEGER)";							 
						},
					    findByExternalId : function (externalId) {
							var query, values;
							return new t.promise(function (resolve,reject) {
								try {
									query = "SELECT * FROM " + this.getTableName() + " WHERE  external_id = ? LIMIT 1";
									this.getDBConnect().queryRow(query,[externalId]).then(
										function success(result) {						
											resolve(result);
										},
										function error (error) {
											reject(error);
										}
									);
								}
								catch(e){
									reject(e);
								}
							}.bind(this));
						}
					});
					model = new FilemanagerModel();
					var data = {external_id: 11,name : "test",local_path : "c:\zzz\a.pdf",parent_id : 0, type : 1, last_action_id : 123,hash : "sdsdfsdf",updated :1};
					//model.add(data).then(function (a) {console.log(a)} , function (a) {console.error(a)});
					var start = new Date().getTime();
					model.findByExternalId(18).then(function (result) {						
						test = model.loadRecord(result);
						console.log((new Date().getTime() - start) / 1000);
					},
					function (error) {
						console.log(error);
					}
					);
			});
		</script>
	</body>
</html>